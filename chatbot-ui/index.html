<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MindEase - Mental Health Companion</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <!-- Navbar -->
    <nav class="navbar">
        <div class="logo">MindEase</div>
        <ul class="nav-links">
            <li><a href="#">Home</a></li>
            <li><a href="#">Resources</a></li>
            <li><a href="#">About</a></li>
            <li><a href="#">Contact</a></li>
        </ul>
    </nav>

    <!-- Hero Section -->
    <section class="hero">
        <h1>Your Mental Health Companion</h1>
        <p>
            MindEase is here to support your emotional well-being.
            Chat confidentially, get self-care tips, and explore ways
            to stay mentally strong every day.
        </p>
    </section>

    <!-- Floating Chat Button -->
    <div class="chat-toggle" onclick="toggleChat()">ðŸ’¬</div>

    <!-- Chatbot Container -->
    <div id="chatContainer" class="chat-container">

        <div class="chat-card">

            <div class="chat-header">
                <span>MindEase Chatbot</span>
                <!-- Circular Close Button -->
                <div class="chat-close" onclick="toggleChat()">âœ•</div>
            </div>

            <div id="chatBox" class="chat-box"></div>

            <div class="chat-input-area">
                <input type="text" id="userInput"
                       placeholder="Type your message..."
                       onkeydown="if(event.key==='Enter') sendMessage()">

                <button onclick="sendMessage()">âž¤</button>
            </div>

        </div>

    </div>

    <script>
        const API_URL = "http://127.0.0.1:8000/chat";
        const session_id = "user_" + Math.floor(Math.random() * 10000);

        function toggleChat() {
            const chat = document.getElementById("chatContainer");
            chat.style.display = chat.style.display === "flex" ? "none" : "flex";
        }

        function showTypingIndicator() {
            const box = document.getElementById("chatBox");
            
            const typingDiv = document.createElement("div");
            typingDiv.classList.add("message", "bot");
            typingDiv.id = "typingIndicator";
            
            const avatar = document.createElement("div");
            avatar.classList.add("avatar");
            avatar.innerHTML = "ðŸ¤–";
            
            const bubble = document.createElement("div");
            bubble.classList.add("bubble");
            bubble.innerHTML = '<div class="typing"><span></span><span></span><span></span></div>';
            
            typingDiv.appendChild(avatar);
            typingDiv.appendChild(bubble);
            box.appendChild(typingDiv);
            
            box.scrollTop = box.scrollHeight;
        }
        
        function hideTypingIndicator() {
            const indicator = document.getElementById("typingIndicator");
            if (indicator) {
                indicator.remove();
            }
        }

        function appendMessage(role, text) {
            const box = document.getElementById("chatBox");

            const messageWrapper = document.createElement("div");
            messageWrapper.classList.add("message", role === "You" ? "user" : "bot");

            if (role !== "You") {
                const avatar = document.createElement("div");
                avatar.classList.add("avatar");
                avatar.innerHTML = "ðŸ¤–";
                messageWrapper.appendChild(avatar);
            }

            const bubble = document.createElement("div");
            bubble.classList.add("bubble");
            bubble.innerText = text;

            messageWrapper.appendChild(bubble);
            box.appendChild(messageWrapper);

            box.scrollTop = box.scrollHeight;
        }

        async function sendMessage() {
            const input = document.getElementById("userInput");
            const text = input.value.trim();
            if (!text) return;

            appendMessage("You", text);
            input.value = "";
            
            // Show typing indicator
            showTypingIndicator();

            try {
                const res = await fetch(API_URL, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        session_id: session_id,
                        query: text
                    })
                });

                const data = await res.json();
                
                // Hide typing indicator
                hideTypingIndicator();
                
                if (data.response) {
                    appendMessage("Bot", data.response);
                } else if (data.error) {
                    appendMessage("Bot", "Sorry, I'm having trouble responding right now. Please try again later.");
                } else {
                    appendMessage("Bot", "I'm here to help you.");
                }

            } catch (error) {
                // Hide typing indicator on error too
                hideTypingIndicator();
                appendMessage("Bot", "Unable to connect to server.");
            }
        }
    </script>

</body>
</html>
